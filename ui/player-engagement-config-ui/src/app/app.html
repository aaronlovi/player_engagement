<div class="page">
  <header class="page__header">
    <div>
      <h1>Player Engagement Scaffold</h1>
      <p class="page__description">
        Quick health checks and XP stubs confirm the backend host is reachable from Angular.
      </p>
    </div>
    <div class="page__actions">
      <button type="button" (click)="refreshAll()" [disabled]="isRefreshing()">
        {{ isRefreshing() ? 'Refreshing…' : 'Refresh health & ledger' }}
      </button>
      <button type="button" class="secondary" (click)="callXpGrant()" [disabled]="isGrantPending()">
        {{ isGrantPending() ? 'Calling grant…' : 'Call XP grant stub' }}
      </button>
    </div>
  </header>

  <section class="panel">
    <h2>Health endpoints</h2>

    <div class="card" *ngIf="liveState() as live">
      <div class="card__heading">
        <h3>/health/live</h3>
        <span class="badge" [class.badge--ok]="live.success === true" [class.badge--warn]="live.success === false">
          {{ live.loading ? 'Loading…' : live.success === true ? 'Healthy' : 'Stub' }}
        </span>
      </div>
      <dl>
        <div class="card__row">
          <dt>Status code</dt>
          <dd>{{ live.status ?? '—' }}</dd>
        </div>
        <div class="card__row">
          <dt>Payload</dt>
          <dd><pre>{{ toJson(live.body) }}</pre></dd>
        </div>
        <div class="card__row" *ngIf="live.error">
          <dt>Error</dt>
          <dd>{{ live.error }}</dd>
        </div>
      </dl>
    </div>

    <div class="card" *ngIf="readyState() as ready">
      <div class="card__heading">
        <h3>/health/ready</h3>
        <span class="badge" [class.badge--ok]="ready.success === true" [class.badge--warn]="ready.success === false">
          {{ ready.loading ? 'Loading…' : ready.success === true ? 'Ready' : 'Stub' }}
        </span>
      </div>
      <dl>
        <div class="card__row">
          <dt>Status code</dt>
          <dd>{{ ready.status ?? '—' }}</dd>
        </div>
        <div class="card__row">
          <dt>Payload</dt>
          <dd><pre>{{ toJson(ready.body) }}</pre></dd>
        </div>
        <div class="card__row" *ngIf="ready.error">
          <dt>Error</dt>
          <dd>{{ ready.error }}</dd>
        </div>
      </dl>
    </div>
  </section>

  <section class="panel">
    <h2>XP stubs</h2>

    <div class="card" *ngIf="ledgerState() as ledger">
      <div class="card__heading">
        <h3>GET /xp/ledger</h3>
        <span class="badge" [class.badge--ok]="ledger.success === true" [class.badge--warn]="ledger.success === false">
          {{ ledger.loading ? 'Loading…' : ledger.success === true ? 'Sample' : 'Stub' }}
        </span>
      </div>
      <dl>
        <div class="card__row">
          <dt>Status code</dt>
          <dd>{{ ledger.status ?? '—' }}</dd>
        </div>
        <div class="card__row">
          <dt>Payload</dt>
          <dd><pre>{{ toJson(ledger.body) }}</pre></dd>
        </div>
        <div class="card__row" *ngIf="ledger.error">
          <dt>Error</dt>
          <dd>{{ ledger.error }}</dd>
        </div>
      </dl>
    </div>

    <div class="card" *ngIf="grantState() as grant">
      <div class="card__heading">
        <h3>POST /xp/grants</h3>
        <span class="badge" [class.badge--ok]="grant.success === true" [class.badge--warn]="grant.success === false">
          {{ grant.loading ? 'Loading…' : grant.success === true ? 'Placeholder' : 'Stub' }}
        </span>
      </div>
      <dl>
        <div class="card__row">
          <dt>Status code</dt>
          <dd>{{ grant.status ?? '—' }}</dd>
        </div>
        <div class="card__row">
          <dt>Payload</dt>
          <dd><pre>{{ toJson(grant.body) }}</pre></dd>
        </div>
        <div class="card__row" *ngIf="grant.error">
          <dt>Error</dt>
          <dd>{{ grant.error }}</dd>
        </div>
      </dl>
      <p class="hint">
        This endpoint returns <code>501</code> until XP workflows are implemented. Use it to verify CORS and logging.
      </p>
    </div>
  </section>
</div>
