# Scaffolding Detailed Tasks

Last reviewed after resetting the scope to scaffolding-only (Task 3 Step 8 - Document Follow-ups).

## Completed Foundations

| Status | ID | Section                    | Task Title                             | Description / Acceptance Criteria                                                                                              | Expected Output                                                                   | Notes / Tips                                                                                 |
|--------|----|----------------------------|----------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| [x]    | 1  | Environment Setup          | Initialize solution skeleton           | `PlayerEngagement.sln` lives under `src/` and references Host, Infrastructure, and Domain projects.                            | `src/PlayerEngagement.sln`                                                        | Already in repo; no further action required.                                                  |
| [x]    | 2  | Environment Setup          | Configure DbmOptions                   | Provide Postgres `DbmOptions` (provider, connection string, placeholders) in host configuration files.                         | `src/PlayerEngagement.Host/appsettings.json` + `.Development.json`                | Secrets can move to environment variables when running locally.                               |
| [x]    | 3  | Local Tooling              | Provision docker compose               | Supply docker compose file for Postgres + pgAdmin with configurable env vars.                                                  | `infra/docker-compose.yml`                                                        | `.env` or shell exports define credentials and versions.                                      |
| [x]    | 4  | Database Schema            | Author V001__init_schema.sql           | Embed the `${schema}`-tokenized init migration defining XP tables, helper function, constraints, and indexes.                   | `src/PlayerEngagement.Infrastructure/Persistence/Migrations/V001__init_schema.sql` | Migration validated locally; follow-up items captured in `scaffolding_followups.md`.          |
| [x]    | 5  | Persistence Infrastructure | Implement Dbm service + host wiring    | Provide Dbm service, in-memory fallback, and host bootstrap that resolves migrations on startup.                                | Files under `src/PlayerEngagement.Infrastructure/Persistence/`; `Host/Program.cs` | Mirrors `InnoAndLogic` patterns; extend only if new providers appear.                         |

## Next Actions (Scaffolding Phase)

| Status | ID | Section        | Task Title                               | Description / Acceptance Criteria                                                                                                                   | Input Dependencies | Expected Output                                                       | Complexity (1-3) | Notes / Tips                                                                 |
|--------|----|----------------|------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|--------------------|------------------------------------------------------------------------|------------------|-------------------------------------------------------------------------------|
| [x]    | 6  | Backend Host   | Stub Minimal API surface                 | Expose `/health/live`, `/health/ready`, and placeholder `/xp/*` endpoints in the host. Return `501` or sample payloads so clients can verify wiring. | Tasks 1-5          | `src/PlayerEngagement.Host/Program.cs` (or new `Api/` files)           | 1                | Keep logic-free; document TODOs for future handlers.                       |
| [x]    | 7  | Backend Host   | Enable CORS + request logging            | Allow local Angular origin (e.g., `http://localhost:4200`) and add basic request logging sufficient for debugging the scaffold.                     | Task 6             | Updates in `Program.cs` + logging configuration                         | 1                | Use built-in logging extensions; keep CORS list tight (revisit after Angular scaffolding).                     |
| [x]    | 8  | Documentation  | Add run instructions                     | Document how to start docker compose, apply migrations, run the host, and hit the stub endpoints.                                                   | Tasks 3, 6, 7      | New section in project README or `docs/scaffolding/quickstart.md`       | 1                | Quickstart now documents health endpoints; update again once Angular UI lands.                  |
| [ ]    | 9  | Angular UI     | Scaffold Angular workspace               | Generate `ui/player-engagement-config-ui/` via Angular CLI with routing and environment configuration.                                              | None               | Angular workspace committed under `ui/`                                 | 2                | Configure API base URL via environment files.                              |
| [ ]    | 10 | Angular UI     | Implement API service + placeholder page | Add Angular service that calls the stubbed backend endpoints and a simple component displaying the responses.                                       | Tasks 6, 7, 9      | Service/component files under the Angular workspace                     | 2                | Use HttpClient; handle 501 responses gracefully for now.                  |
| [ ]    | 11 | Verification   | Manual connectivity smoke-test           | Document a short checklist proving host + Angular communicate (docker up, host run, Angular run, page displays stub data).                          | Tasks 6-10         | Notes added to the quickstart or separate verification doc              | 1                | Capture commands and expected responses for future onboarding.            |

## Deferred (Post-Scaffolding) Backlog

These items remain intentionally out of scope until scaffolding is complete. Track them separately to avoid mixing business logic with the shell work.

- Domain models, repository implementations, and Orleans grain logic (grants, streaks, rules).
- Balance projection service and additional migrations or triggers.
- xUnit integration/unit test suites covering domain behavior.
- Full Angular feature set (rule editor, dashboards, authentication, production styling).

## Directory Map

| Path                                                                 | Purpose                                                                                         | Status        | Notes                                                                                               |
|----------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|---------------|-----------------------------------------------------------------------------------------------------|
| `src/PlayerEngagement.sln`                                          | Solution file linking host, infrastructure, and placeholder domain project.                     | Exists        | Already aligned with repository structure.                                                          |
| `src/PlayerEngagement.Host/`                                        | Orleans host, startup configuration, and Minimal API stubs.                                     | Exists        | `Program.cs` currently bootstraps the silo and validates migrations.                                |
| `src/PlayerEngagement.Infrastructure/`                              | Persistence layer with Dbm services and migrations.                                             | Exists        | Migrations embed under `Persistence/Migrations`; `Statements/` ready for future SQL snippets.       |
| `src/PlayerEngagement.Domain/`                                      | Placeholder for future domain models and grains.                                                | Exists (stub) | Populate once scaffolding tasks give way to feature work.                                           |
| `ui/player-engagement-config-ui/`                                   | Angular workspace for admin UI.                                                                 | Planned       | Generated during Task 9.                                                                            |
| `tests/PlayerEngagement.Tests/`                                     | Future test project (integration/unit).                                                         | Planned       | Scaffold in post-scaffolding phase alongside real logic.                                            |
| `infra/docker-compose.yml`                                          | Local Postgres and pgAdmin orchestration.                                                       | Exists        | Requires `.env` or exported variables for version/credentials.                                      |
| `docs/scaffolding/`                                                 | Planning notes, follow-ups, and quickstart documentation.                                       | Exists        | Keep `scaffolding_followups.md` and this file in sync.                                              |

## Pathing for Active Tasks

| Task Area             | Target Location                                                                                  | Notes                                                                                      |
|-----------------------|---------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
| Minimal API stubs     | `src/PlayerEngagement.Host/Program.cs` (or `Host/Api/*` helpers)                                 | Consider extracting endpoint registration into extension methods for clarity.             |
| CORS & logging config | `src/PlayerEngagement.Host/Program.cs`                                                          | Keep configuration minimal; log to console only.                                          |
| Angular workspace     | `ui/player-engagement-config-ui/`                                                                | Use Angular CLI defaults; update `proxy.conf` or environment for API base URL.            |
| Documentation         | `docs/scaffolding/quickstart.md` (new) and/or project README                                     | Centralize developer run instructions.                                                    |
| Smoke-test checklist  | Same quickstart doc or `docs/scaffolding/verification_notes.md`                                  | Ensure steps reference health endpoints and Angular placeholder page.                     |